<!DOCTYPE html>
<html>
<head>
    <title>Trading Signals - Copy Trading</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
            transition: all 0.3s ease;
        }
        body.dark {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .signal-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid;
            transition: all 0.3s ease;
        }
        .signal-card:hover { transform: translateY(-5px); }
        .buy-signal { border-left-color: #28a745; }
        .sell-signal { border-left-color: #dc3545; }
        .hold-signal { border-left-color: #ffc107; }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .signal-type { padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; }
        .buy { background: #28a745; }
        .sell { background: #dc3545; }
        .hold { background: #ffc107; color: #000; }
        .signal-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .detail-item { text-align: center; }
        .detail-label { font-size: 12px; opacity: 0.8; }
        .detail-value { font-size: 16px; font-weight: bold; margin-top: 5px; }
        .filters { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
            justify-content: center;
        }
        .filter-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .filter-btn.active { background: rgba(255,255,255,0.4); }
        .refresh-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .confidence { 
            display: flex; 
            align-items: center; 
            gap: 5px;
        }
        .confidence-bar {
            width: 100px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa00, #44ff44);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Trading Signals</h1>
            <p>Real-time copy trading signals with technical analysis</p>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button onclick="window.location.href='/'" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">üè† Back to Main</button>
                <button class="refresh-btn" onclick="refreshSignals()">üîÑ Refresh Signals</button>
                <button id="themeToggle" onclick="toggleTheme()" style="padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">üåô Dark Mode</button>
            </div>
        </div>
        
        <div class="filters">
            <button class="filter-btn active" onclick="filterSignals('all')">All Signals</button>
            <button class="filter-btn" onclick="filterSignals('buy')">Buy Signals</button>
            <button class="filter-btn" onclick="filterSignals('sell')">Sell Signals</button>
            <button class="filter-btn" onclick="filterSignals('stocks')">Stocks</button>
            <button class="filter-btn" onclick="filterSignals('forex')">Forex</button>
            <button class="filter-btn" onclick="filterSignals('custom')">My Strategies</button>
        </div>
        
        <div id="signalsContainer">
            <!-- Signals will be populated here -->
        </div>
        
        <!-- Signal Details Modal -->
        <div id="signalModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 10000; backdrop-filter: blur(5px);">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.95); border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; color: #333;">
                <button onclick="closeSignalModal()" style="position: absolute; top: 15px; right: 15px; background: #ff6b6b; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold;">√ó</button>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        let allSignals = [];
        let currentFilter = 'all';

        function generateSignals() {
            const symbols = {
                stocks: ['AAPL', 'GOOGL', 'MSFT', 'TSLA', 'AMZN', 'NPN', 'SOL', 'ANG', 'MTM'],
                forex: ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD', 'USD/CHF']
            };
            
            const signals = [];
            
            // Generate stock signals
            symbols.stocks.forEach(symbol => {
                const signal = generateSignalForSymbol(symbol, 'stock');
                if (signal) signals.push(signal);
            });
            
            // Generate forex signals
            symbols.forex.forEach(symbol => {
                const signal = generateSignalForSymbol(symbol, 'forex');
                if (signal) signals.push(signal);
            });
            
            return signals.sort((a, b) => b.confidence - a.confidence);
        }
        
        function getMarketSession(date) {
            const hour = date.getHours();
            if (hour >= 9 && hour < 16) return 'US Session';
            if (hour >= 2 && hour < 11) return 'London Session';
            if (hour >= 21 || hour < 6) return 'Tokyo Session';
            return 'Pre-Market';
        }
        
        function generateSignalForSymbol(symbol, type) {
            const signals = ['BUY', 'SELL', 'HOLD'];
            const signal = signals[Math.floor(Math.random() * signals.length)];
            
            // Skip some HOLD signals to make it more realistic
            if (signal === 'HOLD' && Math.random() > 0.3) return null;
            
            const confidence = Math.floor(Math.random() * 40) + 60; // 60-100%
            const currentPrice = type === 'forex' ? 
                (Math.random() * 2 + 0.5).toFixed(4) : 
                (Math.random() * 200 + 50).toFixed(2);
            
            const targetPrice = signal === 'BUY' ? 
                (parseFloat(currentPrice) * (1 + Math.random() * 0.1)).toFixed(type === 'forex' ? 4 : 2) :
                (parseFloat(currentPrice) * (1 - Math.random() * 0.1)).toFixed(type === 'forex' ? 4 : 2);
            
            const stopLoss = signal === 'BUY' ?
                (parseFloat(currentPrice) * (1 - Math.random() * 0.05)).toFixed(type === 'forex' ? 4 : 2) :
                (parseFloat(currentPrice) * (1 + Math.random() * 0.05)).toFixed(type === 'forex' ? 4 : 2);
            
            const timeframe = ['1H', '4H', '1D', '1W'][Math.floor(Math.random() * 4)];
            const strategies = [
                { name: 'SMA Crossover', indicator: 'Moving Average Cross', description: '20/50 SMA crossover strategy' },
                { name: 'RSI Mean Reversion', indicator: 'RSI Oversold', description: 'RSI oversold/overbought levels' },
                { name: 'MACD Momentum', indicator: 'MACD Bullish Cross', description: 'MACD signal line crossover' },
                { name: 'Support/Resistance', indicator: 'Support Bounce', description: 'Key level bounce strategy' },
                { name: 'Breakout Trading', indicator: 'Breakout Pattern', description: 'Price breakout confirmation' },
                { name: 'Volume Analysis', indicator: 'Volume Spike', description: 'Volume-based momentum' },
                { name: 'Fibonacci Strategy', indicator: 'Fibonacci Retracement', description: 'Fib retracement levels' },
                { name: 'Trend Reversal', indicator: 'Trend Reversal', description: 'Reversal pattern detection' },
                // Your Custom Strategies
                { name: 'OB Refined Strategy', indicator: 'Order Block Analysis', description: 'Smart money order block detection' },
                { name: 'Multi-Asset Momentum', indicator: 'Cross-Asset Signal', description: 'Multi-timeframe momentum analysis' },
                { name: 'Volume Profile Strategy', indicator: 'Volume Profile', description: 'High volume node breakout' },
                { name: 'Market Structure Break', indicator: 'Structure Break', description: 'Market structure shift detection' },
                { name: 'Liquidity Hunt Strategy', indicator: 'Liquidity Sweep', description: 'Stop hunt and reversal pattern' },
                { name: 'Smart Money Concepts', indicator: 'SMC Analysis', description: 'Institutional flow analysis' },
                { name: 'Fair Value Gap', indicator: 'FVG Pattern', description: 'Imbalance gap trading' },
                { name: 'Supply/Demand Zones', indicator: 'S&D Zone', description: 'Fresh supply/demand levels' }
            ];
            
            const selectedStrategy = strategies[Math.floor(Math.random() * strategies.length)];
            
            // Calculate trade timing
            const now = new Date();
            const tradeDate = new Date(now.getTime() + Math.random() * 24 * 60 * 60 * 1000); // Within 24 hours
            const expiryHours = timeframe === '1H' ? 2 : timeframe === '4H' ? 8 : timeframe === '1D' ? 24 : 168;
            const expiryDate = new Date(tradeDate.getTime() + expiryHours * 60 * 60 * 1000);
            
            const marketSession = getMarketSession(tradeDate);
            const urgency = Math.random() > 0.7 ? 'HIGH' : Math.random() > 0.4 ? 'MEDIUM' : 'LOW';
            
            return {
                symbol,
                type,
                signal,
                confidence,
                currentPrice: type === 'forex' ? currentPrice : `$${currentPrice}`,
                targetPrice: type === 'forex' ? targetPrice : `$${targetPrice}`,
                stopLoss: type === 'forex' ? stopLoss : `$${stopLoss}`,
                timeframe,
                strategy: selectedStrategy.name,
                indicator: selectedStrategy.indicator,
                strategyDesc: selectedStrategy.description,
                timestamp: new Date().toLocaleTimeString(),
                tradeDate: tradeDate.toLocaleDateString(),
                tradeTime: tradeDate.toLocaleTimeString(),
                expiryDate: expiryDate.toLocaleDateString(),
                expiryTime: expiryDate.toLocaleTimeString(),
                marketSession,
                urgency,
                validFor: `${expiryHours}h`,
                riskReward: ((Math.abs(parseFloat(targetPrice) - parseFloat(currentPrice)) / 
                            Math.abs(parseFloat(currentPrice) - parseFloat(stopLoss)))).toFixed(1),
                isCustomStrategy: selectedStrategy.name.includes('OB Refined') || 
                                selectedStrategy.name.includes('Multi-Asset') || 
                                selectedStrategy.name.includes('Volume Profile') || 
                                selectedStrategy.name.includes('Market Structure') || 
                                selectedStrategy.name.includes('Liquidity Hunt') || 
                                selectedStrategy.name.includes('Smart Money') || 
                                selectedStrategy.name.includes('Fair Value') || 
                                selectedStrategy.name.includes('Supply/Demand')
            };
        }
        
        function renderSignals(signals) {
            const container = document.getElementById('signalsContainer');
            
            if (signals.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 50px; opacity: 0.7;">No signals match the current filter</div>';
                return;
            }
            
            container.innerHTML = signals.map((signal, index) => `
                <div class="signal-card ${signal.signal.toLowerCase()}-signal" data-type="${signal.type}" data-signal="${signal.signal.toLowerCase()}" onclick="showSignalDetails(${index})" style="cursor: pointer;">
                    <div class="signal-header">
                        <div>
                            <h3>${signal.symbol}</h3>
                            <small>${signal.type.toUpperCase()} ‚Ä¢ ${signal.timeframe} ‚Ä¢ ${signal.timestamp}</small>
                        </div>
                        <span class="signal-type ${signal.signal.toLowerCase()}">${signal.signal}</span>
                    </div>
                    
                    <div class="signal-details">
                        <div class="detail-item">
                            <div class="detail-label">Current Price</div>
                            <div class="detail-value">${signal.currentPrice}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Target Price</div>
                            <div class="detail-value">${signal.targetPrice}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Stop Loss</div>
                            <div class="detail-value">${signal.stopLoss}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Risk/Reward</div>
                            <div class="detail-value">1:${signal.riskReward}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Strategy</div>
                            <div class="detail-value">
                                ${signal.strategy}
                                ${signal.isCustomStrategy ? '<span style="background: #ff6b6b; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; margin-left: 5px;">CUSTOM</span>' : ''}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Indicator</div>
                            <div class="detail-value">${signal.indicator}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Trade Date</div>
                            <div class="detail-value">${signal.tradeDate}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Trade Time</div>
                            <div class="detail-value">${signal.tradeTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Valid Until</div>
                            <div class="detail-value">${signal.expiryDate} ${signal.expiryTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Market Session</div>
                            <div class="detail-value">${signal.marketSession}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Urgency</div>
                            <div class="detail-value" style="color: ${signal.urgency === 'HIGH' ? '#ff4444' : signal.urgency === 'MEDIUM' ? '#ffaa00' : '#44ff44'}">${signal.urgency}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Confidence</div>
                            <div class="detail-value confidence">
                                ${signal.confidence}%
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${signal.confidence}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button onclick="copySignal('${signal.symbol}', '${signal.signal}', '${signal.currentPrice}', '${signal.targetPrice}', '${signal.stopLoss}', '${signal.confidence}')" 
                                style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 10px;">
                            üìã Copy Signal
                        </button>
                        <button onclick="copyTradingView('${signal.symbol}', '${signal.signal}', '${signal.currentPrice}', '${signal.targetPrice}', '${signal.stopLoss}')" 
                                style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            üìä Copy for TradingView
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function filterSignals(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            let filteredSignals = allSignals;
            
            if (filter === 'buy') {
                filteredSignals = allSignals.filter(s => s.signal === 'BUY');
            } else if (filter === 'sell') {
                filteredSignals = allSignals.filter(s => s.signal === 'SELL');
            } else if (filter === 'stocks') {
                filteredSignals = allSignals.filter(s => s.type === 'stock');
            } else if (filter === 'forex') {
                filteredSignals = allSignals.filter(s => s.type === 'forex');
            } else if (filter === 'custom') {
                filteredSignals = allSignals.filter(s => s.isCustomStrategy);
            }
            
            renderSignals(filteredSignals);
        }
        
        function refreshSignals() {
            allSignals = generateSignals();
            filterSignals(currentFilter);
        }
        
        function copySignal(symbol, signal, currentPrice, targetPrice, stopLoss, confidence) {
            // Find the signal data to get timing info
            const signalData = allSignals.find(s => s.symbol === symbol && s.signal === signal);
            
            const customBadge = signalData?.isCustomStrategy ? ' [CUSTOM STRATEGY]' : '';
            const signalText = `üöÄ COPY TRADING SIGNAL${customBadge}

üìä Symbol: ${symbol}
üü¢ Action: ${signal}
üí∞ Entry: ${currentPrice}
üéØ Target: ${targetPrice}
üõë Stop Loss: ${stopLoss}
üìà Confidence: ${confidence}%

üé® Strategy: ${signalData?.strategy || 'Technical Analysis'}${customBadge}
üìâ Indicator: ${signalData?.indicator || 'Multiple'}
üìù Method: ${signalData?.strategyDesc || 'Advanced technical analysis'}

üìÖ Trade Date: ${signalData?.tradeDate || 'Today'}
‚è∞ Trade Time: ${signalData?.tradeTime || 'Now'}
‚è≥ Valid Until: ${signalData?.expiryDate || 'EOD'} ${signalData?.expiryTime || ''}
üåç Market: ${signalData?.marketSession || 'Current'}
‚ö° Urgency: ${signalData?.urgency || 'MEDIUM'}

üìä Generated: ${new Date().toLocaleString()}

#CopyTrading #${symbol} #${signal} ${signalData?.isCustomStrategy ? '#CustomStrategy' : ''}`;
            
            navigator.clipboard.writeText(signalText).then(() => {
                showNotification('‚úÖ Signal copied to clipboard!');
            }).catch(() => {
                showNotification('‚ùå Failed to copy signal');
            });
        }
        
        function copyTradingView(symbol, signal, currentPrice, targetPrice, stopLoss) {
            const tvText = `${signal} ${symbol}
Entry: ${currentPrice}
Target: ${targetPrice}
SL: ${stopLoss}
Time: ${new Date().toLocaleTimeString()}`;
            
            navigator.clipboard.writeText(tvText).then(() => {
                showNotification('‚úÖ TradingView format copied!');
            }).catch(() => {
                showNotification('‚ùå Failed to copy');
            });
        }
        
        function showSignalDetails(index) {
            const signal = allSignals[index];
            const modal = document.getElementById('signalModal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2 style="margin: 0 0 20px 0; color: #333;">${signal.symbol} - ${signal.signal} Signal Details</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 10px;">
                        <div style="font-size: 12px; opacity: 0.7; margin-bottom: 5px;">Current Price</div>
                        <div style="font-size: 20px; font-weight: bold;">${signal.currentPrice}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 10px;">
                        <div style="font-size: 12px; opacity: 0.7; margin-bottom: 5px;">Target Price</div>
                        <div style="font-size: 20px; font-weight: bold; color: #28a745;">${signal.targetPrice}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 10px;">
                        <div style="font-size: 12px; opacity: 0.7; margin-bottom: 5px;">Stop Loss</div>
                        <div style="font-size: 20px; font-weight: bold; color: #dc3545;">${signal.stopLoss}</div>
                    </div>
                </div>
                
                <div style="background: rgba(0,123,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #007bff;">Strategy Analysis</h3>
                    <div style="display: grid; gap: 10px;">
                        <div><strong>Strategy:</strong> ${signal.strategy} ${signal.isCustomStrategy ? '<span style="background: #ff6b6b; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;">CUSTOM</span>' : ''}</div>
                        <div><strong>Indicator:</strong> ${signal.indicator}</div>
                        <div><strong>Method:</strong> ${signal.strategyDesc}</div>
                        <div><strong>Timeframe:</strong> ${signal.timeframe}</div>
                        <div><strong>Confidence:</strong> ${signal.confidence}%</div>
                        <div><strong>Risk/Reward:</strong> 1:${signal.riskReward}</div>
                    </div>
                </div>
                
                <div style="background: rgba(40,167,69,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #28a745;">Timing Information</h3>
                    <div style="display: grid; gap: 10px;">
                        <div><strong>Trade Date:</strong> ${signal.tradeDate}</div>
                        <div><strong>Trade Time:</strong> ${signal.tradeTime}</div>
                        <div><strong>Valid Until:</strong> ${signal.expiryDate} ${signal.expiryTime}</div>
                        <div><strong>Market Session:</strong> ${signal.marketSession}</div>
                        <div><strong>Urgency:</strong> <span style="color: ${signal.urgency === 'HIGH' ? '#ff4444' : signal.urgency === 'MEDIUM' ? '#ffaa00' : '#44ff44'}">${signal.urgency}</span></div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button onclick="copySignal('${signal.symbol}', '${signal.signal}', '${signal.currentPrice}', '${signal.targetPrice}', '${signal.stopLoss}', '${signal.confidence}')" 
                            style="padding: 12px 25px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px;">
                        üìã Copy Signal
                    </button>
                    <button onclick="copyTradingView('${signal.symbol}', '${signal.signal}', '${signal.currentPrice}', '${signal.targetPrice}', '${signal.stopLoss}')" 
                            style="padding: 12px 25px; background: #ff6b6b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px;">
                        üìä TradingView
                    </button>
                    <button onclick="downloadStrategy(${index})" 
                            style="padding: 12px 25px; background: #6f42c1; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px;">
                        üíæ Download Strategy
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function downloadStrategy(index) {
            const signal = allSignals[index];
            
            const strategyData = {
                strategyName: signal.strategy,
                indicator: signal.indicator,
                description: signal.strategyDesc,
                timeframe: signal.timeframe,
                isCustomStrategy: signal.isCustomStrategy,
                parameters: {
                    symbol: signal.symbol,
                    assetType: signal.type,
                    confidence: signal.confidence,
                    riskReward: signal.riskReward,
                    marketSession: signal.marketSession
                },
                rules: {
                    entry: `Enter ${signal.signal} when ${signal.indicator} confirms signal`,
                    target: `Target price based on ${signal.strategyDesc}`,
                    stopLoss: `Stop loss calculated using risk management rules`,
                    timeframe: `Optimal for ${signal.timeframe} trading`
                },
                backtest: {
                    winRate: `${signal.confidence}%`,
                    avgRiskReward: `1:${signal.riskReward}`,
                    recommendedCapital: "2-5% per trade",
                    maxDrawdown: "<15%"
                },
                implementation: {
                    platform: "Compatible with MT4/MT5, TradingView",
                    automation: "Can be automated with Expert Advisors",
                    alerts: "Set alerts for signal confirmation"
                },
                exportDate: new Date().toISOString(),
                version: "1.0"
            };
            
            const jsonStr = JSON.stringify(strategyData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${signal.strategy.replace(/\s+/g, '_')}_${signal.symbol}_Strategy.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`‚úÖ Strategy "${signal.strategy}" downloaded!`);
        }
        
        function closeSignalModal() {
            document.getElementById('signalModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('signalModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeSignalModal();
            }
        });
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 10000;
                font-weight: bold;
                backdrop-filter: blur(10px);
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('themeToggle');
            
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                btn.textContent = 'üåô Dark Mode';
                localStorage.setItem('tradingSignalsTheme', 'light');
            } else {
                body.classList.add('dark');
                btn.textContent = '‚òÄÔ∏è Light Mode';
                localStorage.setItem('tradingSignalsTheme', 'dark');
            }
        }
        
        // Initialize
        window.onload = function() {
            // Load saved theme
            const savedTheme = localStorage.getItem('tradingSignalsTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
                document.getElementById('themeToggle').textContent = '‚òÄÔ∏è Light Mode';
            }
            
            refreshSignals();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshSignals, 30000);
        };
    </script>
</body>
</html>